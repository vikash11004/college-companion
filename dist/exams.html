<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4895ff">
    <title>Exams - College Companion</title>
    <link rel="stylesheet" href="style.css">
    <script src="app.js" defer></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <button class="back-btn" onclick="history.back()">‚Üê</button>
            <h1>Exams</h1>
        </header>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="upcoming-count">0</div>
                <div class="stat-label">Upcoming</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="completed-count">0</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>

        <div class="card">
            <h2>Add Exam</h2>
            <form id="exam-form">
                <div class="form-group">
                    <label for="subject">Subject</label>
                    <input type="text" id="subject" required>
                </div>
                <div class="form-group">
                    <label for="exam-date">Exam Date</label>
                    <input type="date" id="exam-date" required>
                </div>
                <div class="form-group">
                    <label for="exam-time">Exam Time (Optional)</label>
                    <input type="time" id="exam-time">
                </div>
                <div class="form-group">
                    <label for="syllabus">Syllabus/Topics</label>
                    <textarea id="syllabus" rows="3" placeholder="Topics to study..."></textarea>
                </div>
                <button type="submit" class="btn">Add Exam</button>
            </form>
        </div>

        <div class="card">
            <h2>Your Exams</h2>
            <div id="exams-list">
                <p style="opacity: 0.7; text-align: center;">No exams added yet</p>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="bottom-nav-grid">
            <a href="index.html" class="bottom-nav-item">
                <div class="bottom-nav-icon"><img src="favicons/home.png" alt="Home"></div>
                Home
            </a>
            <a href="cgpa.html" class="bottom-nav-item">
                <div class="bottom-nav-icon"><img src="favicons/CGPA.png" alt="CGPA"></div>
                CGPA
            </a>
            <a href="assignments.html" class="bottom-nav-item">
                <div class="bottom-nav-icon"><img src="favicons/assignment.png" alt="Assignments"></div>
                Tasks
            </a>
            <a href="timetable.html" class="bottom-nav-item">
                <div class="bottom-nav-icon"><img src="favicons/timetable.png" alt="Timetable"></div>
                Schedule
            </a>
            <a href="exams.html" class="bottom-nav-item active">
                <div class="bottom-nav-icon"><img src="favicons/exam.png" alt="Exams"></div>
                Exams
            </a>
        </div>
    </nav>

    <script>
        function loadExams() {
            const exams = storage.getAll('exams');
            const upcoming = exams.filter(e => e.status === 'upcoming').length;
            const completed = exams.filter(e => e.status === 'completed').length;
            
            document.getElementById('upcoming-count').textContent = upcoming;
            document.getElementById('completed-count').textContent = completed;
            
            const examsList = document.getElementById('exams-list');
            
            if (exams.length === 0) {
                examsList.innerHTML = '<p style="opacity: 0.7; text-align: center;">No exams added yet</p>';
                return;
            }
            
            // Sort by exam date
            exams.sort((a, b) => new Date(a.exam_date) - new Date(b.exam_date));
            
            examsList.innerHTML = exams.map(exam => {
                const examDate = new Date(exam.exam_date);
                const today = new Date();
                const isPast = examDate < today && exam.status === 'upcoming';
                const statusClass = exam.status === 'completed' ? 'completed' : (isPast ? 'overdue' : 'upcoming');
                
                return `
                    <div class="list-item ${statusClass}" style="${exam.status === 'completed' ? 'opacity: 0.7;' : ''}">
                        <div class="list-content">
                            <h3 style="${exam.status === 'completed' ? 'text-decoration: line-through;' : ''}">${exam.subject}</h3>
                            <div class="list-meta">
                                ${formatDate(exam.exam_date)}${exam.exam_time ? ' at ' + exam.exam_time : ''}
                                ${isPast ? ' (PAST DUE)' : ''}
                                ${exam.syllabus ? '<br>' + exam.syllabus : ''}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button class="btn btn-secondary" style="padding: 0.5rem; font-size: 0.8rem;" 
                                    onclick="toggleExamStatus(${exam.id})">
                                ${exam.status === 'completed' ? 'Undo' : 'Mark Done'}
                            </button>
                            <button class="delete-btn" onclick="deleteExam(${exam.id})">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function toggleExamStatus(id) {
            const exams = storage.getAll('exams');
            const exam = exams.find(e => e.id === id);
            if (exam) {
                exam.status = exam.status === 'completed' ? 'upcoming' : 'completed';
                storage.save('exams', exams);
                loadExams();
                showFlash(`Exam marked as ${exam.status}`);
            }
        }
        
        function deleteExam(id) {
            if (confirm('Are you sure you want to delete this exam?')) {
                storage.delete('exams', id);
                loadExams();
                showFlash('Exam deleted successfully');
            }
        }
        
        document.getElementById('exam-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const exam = {
                subject: document.getElementById('subject').value,
                exam_date: document.getElementById('exam-date').value,
                exam_time: document.getElementById('exam-time').value,
                syllabus: document.getElementById('syllabus').value,
                status: 'upcoming'
            };
            
            storage.add('exams', exam);
            loadExams();
            showFlash('Exam added successfully!');
            e.target.reset();
        });
        
        // Set default exam date to next week
        document.addEventListener('DOMContentLoaded', () => {
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('exam-date').value = nextWeek.toISOString().split('T')[0];
            loadExams();
        });
    </script>

    <style>
        .list-item.overdue {
            border-left: 4px solid #ef4444;
        }
        .list-item.completed {
            border-left: 4px solid #22c55e;
        }
        .list-item.upcoming {
            border-left: 4px solid var(--primary);
        }
    </style>
</body>
</html>
